@startuml

start

:从聊天在线映射中获取会话对象;
:创建聊天消息对象;
:设置消息内容;
:设置发送用户ID为当前用户ID;
:设置接收用户ID为目标用户ID;
:获取ChatService实例;
if (会话对象为空？) then (是)
    :同步保存聊天消息到数据库;
else (否)
    if (目标用户的会话对象为空？) then (是)
        :向当前会话发送"false"消息;
    else
        :向当前会话发送"true"消息;
    endif
    :异步保存聊天消息到数据库;
endif

stop

@enduml
